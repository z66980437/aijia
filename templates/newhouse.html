
{% extends 'base_main.html' %}

{% block title %}
    爱家-发布新房源
{% endblock %}

{% block css %}
    {{ super() }}
    <link href="/static/css/ihome/newhouse.css" rel="stylesheet">
    <style>
        .detail {
            width: 100%;
            height: 110px;
        }

        .img_input {
            position: relative;
            top: 10px;
            left: 10px;
        }

        .img_button {
            position: relative;
            top: 40px;
        }

        .img_del {
            left: 95px;
        }

        .img_add {
            left: 30px;
        }

        .img {
            width: 100px;
            height: 100px;
            position: relative;
            left: 210px;
            top: -50px;
            display: none;
        }

    </style>

{% endblock %}

{% block content %}

    <div class="container">
        <div class="top-bar">
            <div class="nav-bar">
                <h3 class="page-title">发布新房源</h3>
                <a class="nav-btn fl" href="/house/my_house/"><span><i class="fa fa-angle-left fa-2x"></i></span></a>
            </div>
        </div>
        <div class="houses-con">
        <ul class="houses-list">
            <form id="form-house-info" enctype="multipart/form-data">
                <li>
                    <div class="house-title">
                        <h3>基本信息</h3>
                    </div>
                    <div class="house-content">
                        <div class="form-group">
                            <label for="house-title">房屋标题</label>
                            <input type="text" class="form-control" name="title" id="house-title" required>
                        </div>
                        <div class="form-group">
                            <label for="house-price">每晚价格</label>
                            <input type="number" class="form-control" name="price" id="house-price" required>
                        </div>
                        <div class="form-group">
                            <label for="area-id">所在城区</label>
                            <select class="form-control" id="area-id" name="area_id"></select>
                        </div>
                        <div class="form-group">
                            <label for="house-address">详细地址</label>
                            <textarea class="form-control" name="address" id="house-address" required></textarea>
                        </div>
                    </div>
                </li>
                <li>
                    <div class="house-title">
                        <h3>详细信息</h3>
                    </div>
                    <div class="house-content">
                        <div class="form-group">
                            <label for="house-room-count">出租房间数目</label>
                            <input type="number" class="form-control" name="room_count" id="house-room-count" required>
                        </div>
                        <div class="form-group">
                            <label for="house-acreage">房屋面积</label>
                            <input type="number" class="form-control" name="acreage" id="house-acreage" required>
                        </div>
                        <div class="form-group">
                            <label for="house-unit">户型描述</label>
                            <input type="text" class="form-control" name="unit" id="house-unit" placeholder="如：三室两厅两卫" required>
                        </div>
                        <div class="form-group">
                            <label for="house-capacity">宜住人数</label>
                            <input type="number" class="form-control" name="capacity" id="house-capacity" required>
                        </div>
                        <div class="form-group">
                            <label for="house-beds">卧床配置</label>
                            <input type="text" class="form-control" name="beds" id="house-beds" placeholder="如：双人床:2x1.8x1张 1.5x2x2张" required>
                        </div>
                        <div class="form-group">
                            <label for="house-deposit">押金数额</label>
                            <input type="number" class="form-control" name="deposit" id="house-deposit" required>
                        </div>
                        <div class="form-group">
                            <label for="house-min-days">最少入住天数</label>
                            <input type="number" class="form-control" name="min_days" id="house-min-days" required>
                        </div>
                        <div class="form-group">
                            <label for="house-max-days">最多入住天数</label>
                            <input type="number" class="form-control" name="max_days" id="house-max-days" placeholder="0表示无限制" required>
                        </div>
                    </div>
                </li>
                <li>
                    <div class="house-title">
                        <h3>配套设施</h3>
                    </div>
                    <div class="house-content">
                        <ul class="house-facility-list clearfix"></ul>
                    </div>
                </li>
                <li>
                    <div class="house-title">
                        <h3>添加图片</h3>
                    </div>
                    <div class="house-content">
                        <div class="house-image-cons">
                        </div>
                        <div class="form-group">
                            <label for="house-image">首图</label>
                            <div class="detail">
                                <input type="file" accept="image/*" name="house_image" id="house-image" class="img_input">
                            <img src="" id="house_first" class="img"  style="left: 210px;top: -15px;">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="house-image">细节图</label>
                            <div class="detail">
                                <input type="file" accept="image/*" name="house_detail_image" id="house_detail_image" class="img_input">
                                <button class="img_button img_add" onclick="return false;">添加</button>
                                <button class="img_button img_del" style="display: none">删除</button>
                                <img src="" id="img_preview" class="img">
                            </div>
                        </div>
                    </div>
                </li>
                <input type="submit" class="btn btn-success btn-commit" value="发布房源信息">
                <div class="error-msg text-center"><i class="fa fa-exclamation-circle"></i>请将全部信息填写完整后再提交</div>
            </form>
        </ul>
        </div>
        <div class="popup_con">
            <div class="popup">
                <p><i class="fa fa-spinner fa-spin fa-3x fa-fw"></i></p>
            </div>
            <div class="mask"></div>
        </div>
        <div class="footer">
            <p><span><i class="fa fa-copyright"></i></span>爱家租房&nbsp;&nbsp;享受家的温馨</p>
        </div>
    </div>
{% endblock %}

{% block js %}
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/jquery.form.min.js"></script>
    <script src="/static/plugins/bootstrap/js/bootstrap.min.js"></script>
    <script src="/static/plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js"></script>
    <script src="/static/plugins/bootstrap-datepicker/locales/bootstrap-datepicker.zh-CN.min.js"></script>
    <script src="/static/js/ihome/newhouse.js"></script>

    <script>
        $(function () {
            detail_bind = function(img_input, img_img) {
                //上传图片选择文件改变后刷新预览图
                img_input.change(function (e) {
                //获取目标文件
                var file = e.target.files || e.dataTransfer.files;
                //如果目标文件存在
                if (file) {
                    //定义一个文件阅读器
                    var reader = new FileReader();
                    //文件装载后将其显示在图片预览里
                    reader.onload = function () {
                        img_img.css('display','block');
                        img_img.attr("src", this.result);
                    };
                    //装载文件
                    reader.readAsDataURL(file[0]);
                }
                });
            };
            detail_bind($('#house-image'), $('#house_first'));
            detail_bind($('#house_detail_image'), $('#img_preview'))

            del_button = function () {
                $(this).parent().remove();
                if ($('.img_add').length == 1) {
                    $('.img_add').css('display', 'block')
                }
            };

            add_button = function () {
                id = $('.img_add').length;
                $('.img_add').css('display', 'none')
                $detail = $('<div>').attr('class', 'detail');
                $input = $('<input>').attr('type', 'file').attr('accept', 'image/*').attr('name','house_detail_image').attr('class','img_input');
                $addbutton = $('<button>').attr('class', 'img_button img_add').attr('onclick', 'return false;').text('添加');
                $addbutton.on('click', add_button)
                $delbutton = $('<button>').attr('class', 'img_button img_del').attr('onclick', 'return false;').text('删除');
                $delbutton.on('click', del_button)
                $image = $('<img>').attr('src','').attr('class', 'img')
                detail_bind($input,$image)
                $detail.append($input).append($addbutton).append($delbutton).append($image);
                $(this).parent().parent().append($detail)
            };

            $('.img_add').on('click', add_button)
        })
    </script>
{% endblock %}